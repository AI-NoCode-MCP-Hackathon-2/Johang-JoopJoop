<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.13.216/pdf.min.js"></script>
</head>
<body>
  <h1>PDF 업로드 → 텍스트 추출 → n8n으로 전송</h1>

  <input type="file" id="pdfInput" accept="application/pdf">
  <button id="sendBtn">업로드</button>

  <script>
    const WEBHOOK_URL = "https://n8n.dpgtestbed.kr/webhook-test/73f34187-b08f-48fa-960d-ba9ead6c80f7";

    document.getElementById("sendBtn").addEventListener("click", async () => {
      const file = document.getElementById("pdfInput").files[0];
      if (!file) return alert("파일 먼저 선택!");

      // 1) PDF 파일을 ArrayBuffer로 읽기
      const buffer = await file.arrayBuffer();

      // 2) PDF.js로 텍스트 추출
      const pdf = await pdfjsLib.getDocument(buffer).promise;

      let fullText = "";

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const txt = await page.getTextContent();
        const strings = txt.items.map(item => item.str).join(" ");
        fullText += strings + "\n";
      }

      console.log("추출된 텍스트:", fullText);

      // 3) n8n으로 텍스트만 전송
      const res = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          text: fullText,
          filename: file.name
        }),
      });

      alert("전송 완료!");
    });
  </script>
</body>
</html>
